<br />

<h1 align="center" style="border:0">
  <img src="logo.png" alt="Formast" width="auto" height="120"/>
</h1>
<p align="center">复杂业务场景下的企业级动态表单框架</p>

<br />
<br />
<br />

## :hear_no_evil: 什么是Formast?

Formast（帆桅）是一款应对复杂业务场景的动态表单框架，它基于（后端的）JSON 实现表单的界面渲染、交互、数据提交。

她源于腾讯投资系统，在解决复杂的各类投资、工作流相关的表单后沉淀，由腾讯墨子工作室打造，根据通用的表单开发场景进行抽象，最终成为一套通用的企业级动态表单解决方案。

复杂业务系统中，存在很强的表单灵活性需求。业务方实际业务的快速变化，对表单的细节的变更很频繁。通过将表单的描述以 JSON 的形式动态交由前端渲染，可以在某些场景下，大大提升应对复杂业务的细节变更能力，而无需经过前后端代码修改和发版过程，让表单更加灵活，降低企业在表单处理中的开发成本。Formast 从表单的原子逻辑出发，抽象出一门独特的描述语言，基于特定 schema 的 JSON，解释为不同平台的表单交互界面，既可以跨框架，也可以跨终端。分层设计，区分模型与视图，从开发模式上彻底解决表单中数据与视图关系的混杂不清问题。独特的基于计算的依赖联动，让使用者以最简单的方式处理字段与字段之间的联动关系。在运行过程中，formast 拥有不俗的性能。同时，相比于其他表单方案，formast 更易于理解，更容易上手。

## :tada: 项目特色

- 专门为复杂业务场景的企业级表单设计，考虑到几十种业务表单的复杂需求，与大多数动态表单生成器都不同
- 表单抽象语言 schema JSON 表达形式
- 分离表单 JSON 解释引擎和渲染引擎，轻松实现跨平台渲染
- 超高的性能
- 与现有框架无缝对接，支持 react、vue，只提供核心驱动，其他全由开发者自由实现
- 分层理念：表单分为视图层、模型层、控制层（由formast实现），在特定场景下这将大大提升表单的可靠性

## :egg: 设计理念

Formast 诞生于复杂的业务系统，围绕各种特殊的业务逻辑展开思考，因此，更适合那些有较强字段与字段联系的表单，当然也可应用于简单的填写提交表单。为了能更好的适应业务中，各个字段之间的联动所带来的交互变化，我们设计了一套用以描述表单的动态语言，也就是说，通过一份静态的描述，可以产生千变万化的交互效果。要实现这些目标，同时又要考虑到对于开发人员或者接入人员的友好，降低理解成本，我们需要做非常多的权衡。最终，我们总结出以下原则：

- **JSON 优先**：和某些表单方案不同，我们一开始就将 formast 设计为基于（后端的）JSON 的动态表单驱动实现。虽然有些方案支持既可以在前端用代码编写，同时支持 JSON 驱动，但是，对 formast 而言“动态”强于“静态”，“灵活”大于“迟钝”，响应快速的细节变更是 formast 的核心价值，因此，一开始，我们就只支持 JSON 驱动，而不提供前端代码编写。

- **分层设计**：业务系统表单的一个显著特征在于，字段本身的逻辑非常明确，且表单字段的逻辑严谨是业务严谨的体现，因此，准确的表达字段逻辑的设计对业务系统表单而言非常重要。Formast 基于分层理念，解耦表单的字段描述和界面描述，让后端在实现字段逻辑时可以和前端完全一致。简单讲，如果你使用 formast 进行表单开发，你会得到一个关于表单所反应的业务对象的模型，这个模型包含了该业务对象的各个字段的描述，以及它们之间的关联，通过修改模型，可以快速响应需求方提出的某些业务字段的逻辑变更；同时你会得到一个表单的界面对象，基于 formast 的解释器，你可以把这个界面对象渲染为 react 或 vue 的组件，甚至可以自己写渲染器来决定渲染为什么。界面对象中使用了模型数据，同时也响应模型的变化进行界面更新，形成一个完整的表单统一体。

- **跨平台**：同一个业务，在 PC、APP 上必须保持相同的业务逻辑，这也意味着，在不同的技术栈（框架）上都可以得到我们想要的表单。Formast 之所以称为“框架”，在于她把跨平台的能力和 schema 的解释能力区分开，她的核心能力是拿到 JSON 之后进行解释，解释后的结果可以被渲染到不同平台上。当然，formast 为你提供了内置的 react、vue(2.x) 渲染器，你可以根据自己当前所使用的框架直接使用，也可以根据自己的需求定制自己的渲染器。

- **高性能**：虽然业务系统对准确性的要求高于性能，但是，提供高性能的实现是我们的追求。Formast 采取了特殊的策略，让你在使用她时，可以不需要考虑性能问题，只需要按照特定的方法部署它即可。

## :rocket: 性能

Formast 渲染时拥有超强性能。其原理主要有如下几点：

- 最小响应：每一个 JSON 中的节点都是一个自控制节点，例如在 react 中，父组件的更新不会带来子组件的更新，组件更新由自己决定，而和父组件无关
- 依赖收集：每一个节点是否要更新界面，只关心自己依赖的字段、vars、全局prop是否变化，且变化基于监听，而非脏检查
- 抽象渲染树：一旦 JSON 生成渲染树之后，渲染树的结构是固定的，只是不同节点自己决定是否展示内容（通过 visible）

通过这些原理，在 formast 中，每一个 JSON 节点是自己控制自己的，它的子节点的渲染跟自己没有关系，因此，当需要重新渲染时，节点只关心自己是否需要显示或隐藏，而无需检查子节点（子节点的渲染也是由子节点自己控制自己的），从而节省了页面大范围的重复计算。

## :bread: 开源

MIT.

我们希望你参与到社区中，提出你的建议，如果你发现其中有些错误，即使是错别字，都希望你可以提PR，我们更希望你能参与到 formast 的建设中来，只有你参与进来，她才会朝着你想要的方向前进。
